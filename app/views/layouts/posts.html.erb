<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title>Posts: <%= controller.action_name %></title>
  <%= javascript_include_tag :defaults, "http://#{IPFetcher.get_local_ip}:9292/faye.js" %>
  <%= stylesheet_link_tag 'scaffold' %>
  <script language="javascript" type="text/javascript">
    var faye = new Faye.Client('http://<%= IPFetcher.get_local_ip %>:9292/faye');

    faye.subscribe('/posts/new', function (data) {
      $("posts_list").insert({bottom: data["post"].toString()});

      var post = $("posts_list").childElements().last().childElements().first();

      if(data["user_id"].toString() != "<%= current_user.id %>"){
        post.setStyle({float: "left"});
      }
      new Effect.Highlight(post.id);
    });
  </script>
</head>
<body>
<div id="header" style="background-color:#ccc; border-bottom:1px solid #aaa; text-align:right; font-size:12px; padding: 0 20px;">
  <span>Welcome, <%=h current_user.name%>!</span>
  &nbsp;&nbsp;|&nbsp;&nbsp;
  <span><%= link_to "Logout", "/users/logout" %></span>
</div>  

<p style="color: green"><%= notice %></p>

<%= yield %>


</body>
</html>
